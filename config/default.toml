[server]
host = "0.0.0.0"
port = 8080

[database]
url = "postgres://badge:badge_secret@localhost:5432/badge_db"
max_connections = 50
min_connections = 5
connect_timeout_seconds = 30
idle_timeout_seconds = 600

[redis]
url = "redis://localhost:6379"
pool_size = 20

[kafka]
brokers = "localhost:9092"
consumer_group = "badge-service"
auto_offset_reset = "earliest"
# 消费者超时配置：处理链路含 DB 事务 + 规则匹配 + 通知投递，需留足余量
max_poll_interval_ms = 600000   # 10 分钟，防止慢处理触发 rebalance
session_timeout_ms = 45000      # 45 秒，broker 侧会话超时
heartbeat_interval_ms = 15000   # 15 秒，≤ session_timeout 的 1/3

[kafka.topics]
engagement_events = "badge.engagement.events"
transaction_events = "badge.transaction.events"
notifications = "badge.notifications"
dead_letter_queue = "badge.dlq"
rule_reload = "badge.rule.reload"

[rules]
refresh_interval_secs = 30
initial_load_timeout_secs = 10
idempotency_ttl_hours = 24

[tls]
# 开发环境默认禁用 TLS，生产环境通过 BADGE_TLS_ENABLED=true 启用
enabled = false
# cert_path = "/etc/certs/server.pem"
# key_path = "/etc/certs/server-key.pem"
# ca_path = "/etc/certs/ca.pem"

[kafka.security]
# 开发环境使用 PLAINTEXT，生产环境设置为 SASL_SSL
security_protocol = "PLAINTEXT"
# sasl_mechanism = "SCRAM-SHA-256"
# sasl_username = ""
# sasl_password = ""
# ssl_ca_location = "/etc/certs/kafka-ca.pem"

[config_center]
# 是否启用配置热更新（生产环境建议开启）
enabled = false
# 配置源类型：file（默认，基于文件监听）/ etcd / nacos
backend = "file"
# 文件监听 debounce 时间（毫秒），K8s ConfigMap 更新时会短时间内多次写入
debounce_ms = 2000
# etcd_endpoints = ["http://localhost:2379"]
# nacos_addr = "http://localhost:8848"

[encryption]
# 字段级加密开关：开发环境默认关闭，生产环境通过 BADGE_ENCRYPTION_ENABLED=true 启用
enabled = false
# 加密密钥通过环境变量 BADGE_ENCRYPTION_KEY 提供（hex 编码的 32 字节 / 64 字符）
# 切勿在配置文件中写入密钥明文

[observability]
log_level = "info"
log_format = "pretty"
metrics_enabled = true
metrics_port = 9090
tracing_enabled = false
